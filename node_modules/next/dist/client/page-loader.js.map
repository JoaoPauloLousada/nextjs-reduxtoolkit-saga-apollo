{"version":3,"sources":["../../client/page-loader.ts"],"names":["looseToArray","input","slice","call","getInitialStylesheets","document","styleSheets","filter","el","ownerNode","tagName","hasAttribute","map","sheet","href","getAttribute","text","cssRules","r","cssText","join","hasRel","rel","link","createElement","relList","supports","pageLoadError","route","Error","relPrefetch","relPreload","relPreloadStyle","hasNoModule","normalizeRoute","replace","appendLink","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","loadScript","url","script","__NEXT_MODERN_BUILD","type","src","body","PageLoader","constructor","buildId","assetPrefix","initialPage","pageCache","pageRegisterEvents","loadingRoutes","promisedBuildManifest","promisedSsgManifest","promisedDevPagesManifest","resolve","window","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","__SSG_MANIFEST","__SSG_MANIFEST_CB","getPageList","NODE_ENV","then","buildManifest","sortedPages","__DEV_PAGES_MANIFEST","pages","fetch","json","manifest","catch","err","console","log","getDependencies","m","encodeURI","reject","getDataHref","asPath","ssg","pathname","hrefPathname","searchParams","search","query","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","optional","replaced","Array","isArray","escapePathDelimiters","prefetchData","s","_dataHref","has","querySelector","loadPage","cachedPage","error","fire","pageToCache","off","on","deps","pending","forEach","d","endsWith","push","all","scriptRoute","registerPage","regFn","register","mod","pageData","page","default","emit","module","hot","status","check","removeStatusHandler","fetchStyleSheet","ok","isInitialLoad","promisedDeps","querySelectorAll","e","cssFiles","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import { ComponentType } from 'react'\nimport type { ClientSsgManifest } from '../build'\nimport type { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport mitt from '../next-server/lib/mitt'\nimport type { MittEmitter } from '../next-server/lib/mitt'\nimport { addBasePath, markLoadingError } from '../next-server/lib/router/router'\nimport escapePathDelimiters from '../next-server/lib/router/utils/escape-path-delimiters'\nimport getAssetPathFromRoute from '../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from '../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from '../next-server/lib/router/utils/parse-relative-url'\nimport { searchParamsToUrlQuery } from '../next-server/lib/router/utils/querystring'\nimport { getRouteMatcher } from '../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from '../next-server/lib/router/utils/route-regex'\n\nexport const looseToArray = <T extends {}>(input: any): T[] =>\n  [].slice.call(input)\n\nfunction getInitialStylesheets(): StyleSheetTuple[] {\n  return looseToArray<CSSStyleSheet>(document.styleSheets)\n    .filter(\n      (el: CSSStyleSheet) =>\n        el.ownerNode &&\n        (el.ownerNode as Element).tagName === 'LINK' &&\n        (el.ownerNode as Element).hasAttribute('data-n-p')\n    )\n    .map((sheet) => ({\n      href: (sheet.ownerNode as Element).getAttribute('href')!,\n      text: looseToArray<CSSRule>(sheet.cssRules)\n        .map((r) => r.cssText)\n        .join(''),\n    }))\n}\n\nfunction hasRel(rel: string, link?: HTMLLinkElement) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route: string) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst relPreload = hasRel('preload') ? 'preload' : relPrefetch\nconst relPreloadStyle = 'fetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nfunction normalizeRoute(route: string) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(\n  href: string,\n  rel: string,\n  as?: string,\n  link?: HTMLLinkElement\n): Promise<any> {\n  return new Promise((res, rej) => {\n    link = document.createElement('link')\n\n    // The order of property assignment here is intentional:\n    if (as) link!.as = as\n    link!.rel = rel\n    link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    link!.onload = res\n    link!.onerror = rej\n\n    // `href` should always be last:\n    link!.href = href\n\n    document.head.appendChild(link)\n  })\n}\n\nfunction loadScript(url: string): Promise<any> {\n  return new Promise((res, rej) => {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    script.src = url\n    script.onload = res\n    script.onerror = () => rej(pageLoadError(url))\n    document.body.appendChild(script)\n  })\n}\n\nexport type StyleSheetTuple = { href: string; text: string }\nexport type GoodPageCache = {\n  page: ComponentType\n  mod: any\n  styleSheets: StyleSheetTuple[]\n}\nexport type PageCacheEntry = { error: any } | GoodPageCache\n\nexport default class PageLoader {\n  private initialPage: string\n  private buildId: string\n  private assetPrefix: string\n  private pageCache: Record<string, PageCacheEntry>\n  private pageRegisterEvents: MittEmitter\n  private loadingRoutes: Record<string, boolean>\n  private promisedBuildManifest?: Promise<ClientBuildManifest>\n  private promisedSsgManifest?: Promise<ClientSsgManifest>\n  private promisedDevPagesManifest?: Promise<any>\n\n  constructor(buildId: string, assetPrefix: string, initialPage: string) {\n    this.initialPage = initialPage\n\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    this.promisedBuildManifest = new Promise((resolve) => {\n      if ((window as any).__BUILD_MANIFEST) {\n        resolve((window as any).__BUILD_MANIFEST)\n      } else {\n        ;(window as any).__BUILD_MANIFEST_CB = () => {\n          resolve((window as any).__BUILD_MANIFEST)\n        }\n      }\n    })\n\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if ((window as any).__SSG_MANIFEST) {\n        resolve((window as any).__SSG_MANIFEST)\n      } else {\n        ;(window as any).__SSG_MANIFEST_CB = () => {\n          resolve((window as any).__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  getPageList() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.promisedBuildManifest!.then(\n        (buildManifest) => buildManifest.sortedPages\n      )\n    } else {\n      if ((window as any).__DEV_PAGES_MANIFEST) {\n        return (window as any).__DEV_PAGES_MANIFEST.pages\n      } else {\n        if (!this.promisedDevPagesManifest) {\n          this.promisedDevPagesManifest = fetch(\n            `${this.assetPrefix}/_next/static/development/_devPagesManifest.json`\n          )\n            .then((res) => res.json())\n            .then((manifest) => {\n              ;(window as any).__DEV_PAGES_MANIFEST = manifest\n              return manifest.pages\n            })\n            .catch((err) => {\n              console.log(`Failed to fetch devPagesManifest`, err)\n            })\n        }\n        return this.promisedDevPagesManifest\n      }\n    }\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  private getDependencies(route: string): Promise<string[]> {\n    return this.promisedBuildManifest!.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : Promise.reject(pageLoadError(route))\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href: string, asPath: string, ssg: boolean) {\n    const { pathname: hrefPathname, searchParams, search } = parseRelativeUrl(\n      href\n    )\n    const query = searchParamsToUrlQuery(searchParams)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (path: string) => {\n      const dataRoute = getAssetPathFromRoute(path, '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    let isDynamic: boolean = isDynamicRoute(route),\n      interpolatedRoute: string | undefined\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param] || ''\n          const { repeat, optional } = dynamicGroups[param]\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          let replaced = `[${repeat ? '...' : ''}${param}]`\n          if (optional) {\n            replaced = `${!value ? '/' : ''}[${replaced}]`\n          }\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            (optional || param in dynamicMatches) &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute =\n              interpolatedRoute!.replace(\n                replaced,\n                repeat\n                  ? (value as string[]).map(escapePathDelimiters).join('/')\n                  : escapePathDelimiters(value as string)\n              ) || '/')\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href: string, asPath: string) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest!.then(\n      (s: ClientSsgManifest, _dataHref?: string) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath, true)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch').catch(() => {\n          /* ignore prefetch error */\n        })\n    )\n  }\n\n  loadPage(route: string): Promise<GoodPageCache> {\n    route = normalizeRoute(route)\n\n    return new Promise<GoodPageCache>((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        if ('error' in cachedPage) {\n          reject(cachedPage.error)\n        } else {\n          resolve(cachedPage)\n        }\n        return\n      }\n\n      const fire = (pageToCache: PageCacheEntry) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if ('error' in pageToCache) {\n          reject(pageToCache.error)\n        } else {\n          resolve(pageToCache)\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route)\n            .then((deps) => {\n              const pending: Promise<any>[] = []\n              deps.forEach((d) => {\n                if (\n                  d.endsWith('.js') &&\n                  !document.querySelector(`script[src^=\"${d}\"]`)\n                ) {\n                  pending.push(loadScript(d))\n                }\n\n                // Prefetch CSS as it'll be needed when the page JavaScript\n                // evaluates. This will only trigger if explicit prefetching is\n                // disabled for a <Link>... prefetching in this case is desirable\n                // because we *know* it's going to be used very soon (page was\n                // loaded).\n                if (\n                  d.endsWith('.css') &&\n                  !document.querySelector(\n                    `link[rel=\"${relPreload}\"][href^=\"${d}\"]`\n                  )\n                ) {\n                  // This is not pushed into `pending` because we don't need to\n                  // wait for these to resolve. To prevent an unhandled\n                  // rejection, we swallow the error which is handled later in\n                  // the rendering cycle (this is just a preload optimization).\n                  appendLink(d, relPreload, relPreloadStyle).catch(() => {\n                    /* ignore preload error */\n                  })\n                }\n              })\n              return Promise.all(pending)\n            })\n            .catch((err) => {\n              // Mark the page as failed to load if any of its required scripts\n              // fail to load:\n              this.pageCache[route] = { error: err }\n              fire({ error: err })\n            })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          loadScript(url).catch((err) => {\n            // Mark the page as failed to load if its script fails to load:\n            this.pageCache[route] = { error: err }\n            fire({ error: err })\n          })\n        }\n      }\n    })\n  }\n\n  // This method if called by the route code.\n  registerPage(route: string, regFn: () => any) {\n    const register = (styleSheets: StyleSheetTuple[]) => {\n      try {\n        const mod = regFn()\n        const pageData: PageCacheEntry = {\n          page: mod.default || mod,\n          mod,\n          styleSheets,\n        }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if ((module as any).hot && (module as any).hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status: string) => {\n          if (status === 'idle') {\n            ;(module as any).hot.removeStatusHandler(check)\n            register(\n              /* css is handled via style-loader in development */\n              []\n            )\n          }\n        }\n        ;(module as any).hot.status(check)\n        return\n      }\n    }\n\n    function fetchStyleSheet(href: string): Promise<StyleSheetTuple> {\n      return fetch(href).then((res) => {\n        if (!res.ok) throw pageLoadError(href)\n        return res.text().then((text) => ({ href, text }))\n      })\n    }\n\n    const isInitialLoad = route === this.initialPage\n    const promisedDeps: Promise<StyleSheetTuple[]> =\n      // Shared styles will already be on the page:\n      route === '/_app' ||\n      // We use `style-loader` in development:\n      process.env.NODE_ENV !== 'production'\n        ? Promise.resolve([])\n        : // Tests that this does not block hydration:\n          // test/integration/css-fixtures/hydrate-without-deps/\n          (isInitialLoad\n            ? Promise.resolve(\n                looseToArray<HTMLLinkElement>(\n                  document.querySelectorAll('link[data-n-p]')\n                ).map((e) => e.getAttribute('href')!)\n              )\n            : this.getDependencies(route).then((deps) =>\n                deps.filter((d) => d.endsWith('.css'))\n              )\n          ).then((cssFiles) =>\n            // These files should've already been fetched by now, so this\n            // should resolve instantly.\n            Promise.all(cssFiles.map((d) => fetchStyleSheet(d))).catch(\n              (err) => {\n                if (isInitialLoad) return getInitialStylesheets()\n                throw err\n              }\n            )\n          )\n    promisedDeps.then(\n      (deps) => register(deps),\n      (error) => {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    )\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route: string, isDependency?: boolean): Promise<void> {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = (navigator as any).connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? relPreloadStyle : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}